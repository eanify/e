<!DOCTYPE html>
<html lang="ha">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SyEarn - Loading</title>
    <!-- Telegram SDK -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    
    <style>
        :root {
            --gold: #FFD700;
            --cyan: #00d2ff;
            --dark: #050505;
            --glass: rgba(255, 255, 255, 0.03);
        }

        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            background-color: var(--dark);
            color: white;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        /* Background Glows */
        .bg-glow {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: var(--cyan);
            filter: blur(120px);
            opacity: 0.15;
            z-index: 0;
            top: 10%;
            left: -10%;
        }

        .bg-glow-right {
            position: absolute;
            width: 300px;
            height: 300px;
            border-radius: 50%;
            background: var(--gold);
            filter: blur(120px);
            opacity: 0.1;
            z-index: 0;
            bottom: 10%;
            right: -10%;
        }

        .loader-container {
            position: relative;
            z-index: 10;
            text-align: center;
            width: 100%;
            max-width: 400px;
            padding: 20px;
        }

        /* Logo Area */
        .logo-wrapper {
            position: relative;
            width: 180px;
            height: 180px;
            margin: 0 auto 30px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(0, 210, 255, 0.5));
            animation: float 3s ease-in-out infinite;
            z-index: 2;
        }

        .logo-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border: 2px solid var(--glass);
            border-top: 2px solid var(--gold);
            border-radius: 50%;
            animation: spin 2s linear infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-15px); }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Brand Name */
        h1 {
            font-size: 38px;
            margin: 10px 0 0;
            font-weight: 900;
            letter-spacing: 3px;
            text-transform: uppercase;
            background: linear-gradient(to right, #fff, var(--gold), var(--cyan));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        .tagline {
            color: #555;
            font-size: 11px;
            letter-spacing: 4px;
            margin-top: 5px;
            text-transform: uppercase;
        }

        /* Progress Bar */
        .progress-box {
            margin-top: 60px;
            width: 80%;
            margin-left: 10%;
        }

        .track {
            width: 100%;
            height: 3px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
        }

        .fill {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--cyan));
            box-shadow: 0 0 10px var(--cyan);
            transition: width 0.4s cubic-bezier(0.17, 0.67, 0.83, 0.67);
        }

        #status-text {
            font-size: 10px;
            color: var(--cyan);
            margin-top: 15px;
            font-family: 'Courier New', Courier, monospace;
            text-transform: uppercase;
            opacity: 0.8;
        }

        /* Glass Card Effect */
        .glass-overlay {
            position: absolute;
            width: 120%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,215,0,0.05) 0%, transparent 70%);
            pointer-events: none;
        }
    </style>
</head>
<body>

<div class="bg-glow"></div>
<div class="bg-glow-right"></div>
<div class="glass-overlay"></div>

<div class="loader-container">
    <div class="logo-wrapper">
        <div class="logo-ring"></div>
        <!-- Tabbatar sunan hoton dake folder dinka "logo.png" ne -->
        <img src="logo.png" alt="SyEarn Logo" class="logo-img">
    </div>
    
    <h1>SyEarn</h1>
    <div class="tagline">Next-Gen Earning</div>

    <div class="progress-box">
        <div class="track">
            <div class="fill" id="progress-fill"></div>
        </div>
        <div id="status-text">Connecting to Blockchain...</div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCxIVTzVnuV80gZnJiym_zBaulHwY9jllY",
        authDomain: "syearn-5e918.firebaseapp.com",
        databaseURL: "https://syearn-5e918-default-rtdb.firebaseio.com",
        projectId: "syearn-5e918",
        storageBucket: "syearn-5e918.firebasestorage.app",
        messagingSenderId: "317825926616",
        appId: "1:317825926616:web:a5f4050a8f1c8e522a1ead"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const tg = window.Telegram.WebApp;

    async function initializeSyEarn() {
        const fill = document.getElementById('progress-fill');
        const status = document.getElementById('status-text');

        tg.expand();
        tg.ready();
        tg.headerColor = "#050505";
        tg.backgroundColor = "#050505";

        const user = tg.initDataUnsafe.user;

        if (user) {
            // Stage 1: Auth
            fill.style.width = "30%";
            status.innerText = "Authenticating Node...";

            const userRef = ref(db, 'users/' + user.id);
            
            try {
                const snapshot = await get(userRef);
                fill.style.width = "70%";
                status.innerText = "Syncing Realtime Data...";

                if (!snapshot.exists()) {
                    await set(userRef, {
                        id: user.id,
                        name: user.first_name,
                        username: user.username || "SyUser",
                        balance: 0,
                        referrals: 0,
                        lastSeen: new Date().toISOString()
                    });
                }

                // Final Stage
                fill.style.width = "100%";
                status.innerText = "Initialization Complete";

                setTimeout(() => {
                    window.location.href = "app.html";
                }, 1200);

            } catch (error) {
                status.innerText = "Database Error. Reconnecting...";
                console.error(error);
            }
        } else {
            status.innerText = "Please access via Telegram Bot";
            // Domin gwaji a Browser:
            // setTimeout(() => { window.location.href = "app.html"; }, 3000);
        }
    }

    window.onload = initializeSyEarn;
</script>

</body>
</html>